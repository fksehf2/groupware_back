<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="qnaDAO">

    <sql id="serachCondition">
        <if test="search_select != null and search_select != ''">
            <choose>
                <when test="search_select == 0">
                    <!-- 전체 검색 -->
                    AND(
                    A.TITLE LIKE CONCAT('%', #{search}, '%')
                    OR A.CNTS LIKE CONCAT('%', #{search}, '%')
                    )
                </when>
                <when test="search_select == 1">
                    <!-- 제목 검색 -->
                    AND A.TITLE LIKE CONCAT('%', #{search}, '%')
                </when>
                <when test="search_select == 2">
                    <!-- 제목 + 내용 검색 -->
                    AND(
                    A.TITLE LIKE CONCAT('%', #{search}, '%')
                    OR A.CNTS LIKE CONCAT('%', #{search}, '%')
                    )
                </when>
            </choose>
        </if>

    </sql>

    <select id="qnaBoardList" parameterType="java.util.HashMap" resultType="map">
        SELECT  PUTUP_SNO
                ,TITLE
                ,(SELECT USER_NM FROM USER WHERE USER_ID = A.REGR_ID) AS REGR_NM
                ,REG_DT
                ,SELECT_NUM
        FROM    BOARD a
        WHERE 1=1
        <include refid="serachCondition"/>
        LIMIT #{offset}, #{perPageNum}
    </select>

    <select id="getQnaTotCnt" parameterType="java.util.HashMap" resultType="int">
        SELECT COUNT(*)
        FROM (
                SELECT  PUTUP_SNO
                        ,TITLE
                        ,(SELECT USER_NM FROM USER WHERE USER_ID = A.REGR_ID) AS REGR_NM
                        ,REG_DT
                        ,SELECT_NUM
                FROM    BOARD A
                LIMIT #{offset}, #{perPageNum}
            ) q
    </select>
</mapper>
